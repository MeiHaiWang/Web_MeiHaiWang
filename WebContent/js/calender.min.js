$(function(){function a(a){result=!0;var b=Number(a.substring(5,7)),c=Number(d.substring(5,7)),e=Number(a.substring(8,10)),f=Number(d.substring(8,10));return b==c&&f>e&&(result=!1),c>b&&(result=!1),result}function b(a){for(var b=g.stylist,c=[],d=[],e=0;e<b.length;e++){c[e]=[],d[e]=0;for(var i=0;i<h.length;i++)if(b[e].t_stylist_name==h[i].t_stylist_name)if(d[e]++,h[i].t_reservation_menuId.indexOf("R1")>=0){var j=moment(h[i].t_reservation_date),k=Number(h[i].t_reservation_time-1)/60,l=moment(h[i].t_reservation_date).add("hours",k);c[e].push({from:"/Date("+j.valueOf()+")/",to:"/Date("+l.valueOf()+")/",label:h[i].t_menu_name,customClass:"ganttBlue",dataObj:h[i].t_reservation_id})}else if("R2"==h[i].t_reservation_menuId){var m=h[i].t_reservation_date.substring(0,10),n=f.t_hairSalonMaster_openTime,o=f.t_hairSalonMaster_closeTime,p=Number(o.substring(0,2))-1;o=p+":00";var q=a.substring(0,10)+" "+o,j=moment(m+" "+n),l=moment(m+" "+o);c[e].push({from:"/Date("+j.valueOf()+")/",to:"/Date("+l.valueOf()+")/",label:h[i].t_menu_name,customClass:"ganttBlue",dataObj:h[i].t_reservation_id})}else{var j=moment(h[i].t_reservation_date),k=Number(h[i].t_reservation_time-1)/60,l=moment(h[i].t_reservation_date).add("hours",k),r="ganttOrange";h[i].t_reservation_isFinished>0&&(r="ganttRed"),c[e].push({from:"/Date("+j.valueOf()+")/",to:"/Date("+l.valueOf()+")/",label:h[i].t_menu_name,customClass:r,dataObj:h[i].t_reservation_id})}0==d[e]}var s=[],t=a.substring(0,10)+" "+f.t_hairSalonMaster_openTime,o=f.t_hairSalonMaster_closeTime,p=Number(o.substring(0,2))-1;o=p+":00";var q=a.substring(0,10)+" "+o;s.push({name:"营业时间",desc:"Opentime",id:-1,values:[{from:moment(t).valueOf(),to:moment(q).valueOf(),label:"营业时间",customClass:"ganttGreen",dataObj:"Opentime"}]});for(var e=0;e<b.length;e++)s.push({name:"staff"+e,id:e,desc:b[e].t_stylist_name,values:c[e]});var u=function(a){for(var c=-1,d=0;d<b.length;d++)a==b[d].t_stylist_name&&(c=b[d].t_stylist_Id);return c};$(".gantt").gantt({source:s,scale:"hours",navigate:"scroll",maxScale:"days",itemsPerPage:10,months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dow:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],onItemClick:function(a){"Opentime"==a||(console.log("reservation.html?reservationId="+a),location.href="reservation.html?reservationId="+a)},onAddClick:function(a,b){if(void 0!=b&&b>=0){var c=moment(Number(a)),d=c.year()+"-",e=Number(c.month())+1;d+=10>e?"0"+e+"-":e+"-",d+=c.date()<10?"0"+c.date()+" ":c.date()+" ",d+=c.hours()<10?"0"+c.hours()+":":c.hours()+":",d+=c.minutes()<10?"0"+c.minutes()+":":c.minutes()+":",d+=c.seconds()<10?"0"+c.seconds():c.seconds();var f=u(s[b+1].desc);location.href="reservation.html?time="+d+"&stylistId="+f}},onRender:function(){window.console&&"function"==typeof console.log}})}var c=new Date,d=c.getFullYear()+"-";c.getMonth()+1<10&&(d+="0"),d+=c.getMonth()+1+"-",c.getDate()+1<10&&(d+="0"),d+=c.getDate()+" 09:00:00";var e=getSessionInfo(),f=getSalonInfo({t_hairSalonMaster_salonId:e.t_hairSalonMaster_salonId}),g=getStaffInfo({t_hairSalonMaster_salonId:e.t_hairSalonMaster_salonId}),h={};reservations=getReservationList({t_reservation_salonId:e.t_hairSalonMaster_salonId,t_reservation_date:d}),h=reservations.reservation_list,$("#account-name").text(e.t_hairSalonMaster_contactUserName);var j={},k={},l=0,m=0;for(i=0;i<h.length;i++)0==h[i].t_reservation_isFinished?h[i].t_reservation_menuId.indexOf("R")<0&&(j[l]=h[i],l++):h[i].t_reservation_isFinished>0&&(k[m]=h[i],m++);$("#reserve_number").text(l),$("#customer_number").text(m),$("#datepicker").datepicker({onSelect:function(c,d){var f=moment(c),g=f.year()+"-";f.month()+1<10&&(g+="0"),g+=f.month()+1+"-",f.date()+1<10&&(g+="0"),g+=f.date()+" 09:00:00",reservations=getReservationList({t_reservation_salonId:e.t_hairSalonMaster_salonId,t_reservation_date:g}),h=reservations.reservation_list,0==h.length?(console.log("reservation.html?time="+g+"&stylistId=1"),a(g)?(alert("予約がありません."),b(g)):(alert("予約がありません.　本日より以前の日にちです."),b(g))):b(g)}}),b(d),$("#search_button").on("click",function(){var a=$("#form_user_search").val();console.log("customerlist.html?target="+a),location.href="customerlist.html?target="+a}),$("#reservation_list_button").on("click",function(){console.log("reservationlist.html?date="+d),location.href="reservationlist.html?date="+d}),$("#customer_list_button").on("click",function(){console.log("customerlist.html"),location.href="customerlist.html"})});