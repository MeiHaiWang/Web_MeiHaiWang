$(function(){function a(){var a=location.href;parameters=a.split("?"),params=parameters[1].split("&");var b=[];for(X=0;X<params.length;X++)neet=params[X].split("="),b.push(neet[0]),b[neet[0]]=neet[1];return b}function b(a,b){var c=a,d=Number(c.substring(0,2)),e=Number(c.substring(3,5));ope_hours=Math.floor(b/60),ope_minutes=b%60;var f=d+ope_hours,g=e+ope_minutes;g>=60&&(g-=60,f+=1);var h=10>f?"0"+f:f,i=10>g?"0"+g:g,j=h+":"+i;return console.log("start_time="+c+", total_time="+b+", end_time="+j),j}function c(a,b,c,d){var e=!0,f=a.substring(0,2),g=a.substring(3,5),h=b.substring(0,2),i=b.substring(3,5),j=c.substring(0,2),k=c.substring(3,5),l=d.substring(0,2),m=d.substring(3,5);if(Number(f)<Number(j))Number(h)<Number(j)?e=!1:Number(h)>Number(j)?e=!0:Number(h)==Number(j)&&(Number(i)<Number(k)?e=!1:Number(i)>Number(k)?e=!0:Number(i)==Number(k)&&(e=!1));else if(Number(f)>Number(j)){if(Number(f)>Number(l))return!1;if(Number(f)<Number(l))return!0;Number(f)==Number(l)&&(Number(g)>Number(m)?e=!1:Number(g)<Number(m)?e=!0:Number(g)==Number(m)&&(e=!1))}else Number(f)==Number(j)&&(e=!0);return e}function d(a){var b={t_claim_reservationId:J,t_claim_userId:A.state.t_user_id,t_claim_salonId:H.t_hairSalonMaster_salonId,t_claim_menuId:0,t_claim_date:M,t_claim_message:a};sanitaize.encode(b);var c=setClaim(b);"true"==c.result?(alert("Regist Success"),window.location.reload()):alert("Regist Failed")}function e(a){if(!(0>J)){var b={t_reservation_id:J,t_reservation_isFinished:a};sanitaize.encode(b);var c=setReservationFinish(b);"true"==c.result?(alert("Regist Success"),window.location.reload()):alert("Regist Failed")}}var f,g,h,i=ReactBootstrap.Input,j=React.createClass({displayName:"ReservationStartTime",getDefaultProps:function(){return{t_reservation_start:[""]}},getInitialState:function(){return{t_reservation_start:""}},onChangeSelectValue:function(a){this.setState({t_reservation_start:a.target.value})},render:function(){return React.createElement(i,{type:"text",value:this.state.t_reservation_start,onChange:this.changeText})}}),k=React.createClass({displayName:"ReservationEndTime",getDefaultProps:function(){return{t_reservation_end:[""]}},getInitialState:function(){return{t_reservation_end:""}},onChangeSelectValue:function(a){this.setState({t_reservation_end:a.target.value})},render:function(){return React.createElement(i,{type:"text",value:this.state.t_reservation_end,onChange:this.changeText,disabled:!0})}}),l=React.createClass({displayName:"ReservationUserTel",getInitialState:function(){return{t_user_tel:""}},changeText:function(a){this.setState({t_user_tel:a.target.value})},render:function(){return React.createElement("div",null,React.createElement(i,{type:"text",value:this.state.t_user_tel,onChange:this.changeText,placeholder:"電話番号"}))}}),m=React.createClass({displayName:"ReservationUserName",getInitialState:function(){return{t_user_id:"",t_user_name:""}},changeText:function(a){this.setState({t_user_name:a.target.value})},render:function(){return React.createElement("div",null,React.createElement(i,{type:"text",value:this.state.t_user_name,onChange:this.changeText}))}}),n=React.createClass({displayName:"ReservationUserGender",getInitialState:function(){return{t_user_gender:"0"}},onChangeSelectValue:function(a){this.setState({t_user_gender:a.target.value})},render:function(){return React.createElement("div",null,React.createElement("select",{value:this.state.t_user_gender,onChange:this.onChangeSelectValue},React.createElement("option",{value:"0"},"男性"),React.createElement("option",{value:"1"},"女性")))}}),o=function(){for(var a=[],b=10;70>=b;b++)a.push(b);return a}(),p=React.createClass({displayName:"ReservationUserAge",getDefaultProps:function(){return{t_user_age:o}},getInitialState:function(){return{t_user_age:""}},changeText:function(a){this.setState({t_user_age:a.target.value})},render:function(){var a=this.props.t_user_age.map(function(a){return React.createElement("option",{value:a},a)}),b=React.createElement("div",null,React.createElement("select",{value:this.state.t_user_age,onChange:this.onChangeSelectValue},a));return React.createElement("div",null,b)}}),q=React.createClass({displayName:"ReservationStylist",getDefaultProps:function(){return{stylist:[""]}},getInitialState:function(){return{t_stylist_id:""}},onChangeSelectValue:function(a){this.setState({t_stylist_id:a.target.value})},render:function(){var a=this.props.stylist.map(function(a){return React.createElement("option",{value:a.t_stylist_Id},a.t_stylist_name)});return React.createElement("div",null,React.createElement("select",{value:this.state.t_stylist_id,onChange:this.onChangeSelectValue},a))}}),r=ReactBootstrap.Nav,s=ReactBootstrap.Navbar,t=ReactBootstrap.NavItem,u=(ReactBootstrap.Button,React.createClass({displayName:"ServiceCategory",getDefaultProps:function(){return{category:[""]}},getInitialState:function(){return{t_menu_categoryId:""}},handleSelect:function(a){var b=_(a);F.setState({service_list:b}),this.setState({t_menu_categoryId:a})},render:function(){for(var a=[],b=[],c=0;c<this.props.category.length;c++)6>c?a.push(this.props.category[c]):b.push(this.props.category[c]);var d=a.map(function(a){return React.createElement(t,{bsSize:"xsmall",eventKey:a.t_menuCategory_categoryId},a.t_menuCategory_name)}),e=b.map(function(a){return React.createElement(t,{bsSize:"xsmall",eventKey:a.t_menuCategory_categoryId},a.t_menuCategory_name)});return React.createElement("div",null,React.createElement(s,{bsStyle:"warning"},React.createElement(r,{activeKey:this.state.t_menu_categoryId,onSelect:this.handleSelect},d)),React.createElement(s,{bsStyle:"warning"},React.createElement(r,{activeKey:this.state.t_menu_categoryId,onSelect:this.handleSelect},e)))}})),v=React.createClass({displayName:"ServiceList",getInitialState:function(){return{service_list:[{t_menu_categoryId:"",t_menu_menuId:"",t_menu_name:"",t_menu_price:"",t_menu_time:""}]}},render:function(){var a=this.state.service_list.map(function(a){return React.createElement("tr",null,React.createElement("td",null,a.t_menu_name),React.createElement("td",null,a.t_menu_time),React.createElement("td",null,a.t_menu_price),React.createElement("td",null,React.createElement("a",{className:"reserve"},"予約")))});return React.createElement("div",null,React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"服务名称"),React.createElement("th",null,"Time"),React.createElement("th",null,"Price"),React.createElement("th",null,"予約"))),React.createElement("tbody",null,a,React.createElement("tr",null))))}}),w=React.createClass({displayName:"ServiceList2",getInitialState:function(){return{service_list2:[{t_menu_menuId:"",t_menu_name:"",t_menu_start:"",t_menu_time:"",t_menu_stylist:"",t_menu_seat:"",t_menu_price:""}]}},render:function(){var a=this.state.service_list2.map(function(a){return React.createElement("tr",null,React.createElement("td",null,a.t_menu_name),React.createElement("td",null,a.t_menu_start),React.createElement("td",null,a.t_menu_time),React.createElement("td",null,a.t_menu_stylist),React.createElement("td",null,a.t_menu_seat),React.createElement("td",null,React.createElement("a",{className:"delete"},"削除")))});return React.createElement("div",null,React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"服务名称"),React.createElement("th",null,"Start"),React.createElement("th",null,"Time"),React.createElement("th",null,"Stylist"),React.createElement("th",null,"Seat"),React.createElement("th",null,"削除"))),React.createElement("tbody",null,a)))}}),x=React.render(React.createElement(j,null),document.getElementById("reservation_start")),y=React.render(React.createElement(k,null),document.getElementById("reservation_end")),z=React.render(React.createElement(l,null),document.getElementById("reservation_user_tel")),A=React.render(React.createElement(m,null),document.getElementById("reservation_user_name")),B=React.render(React.createElement(n,null),document.getElementById("reservation_user_sex")),C=React.render(React.createElement(p,null),document.getElementById("reservation_user_age")),D=React.render(React.createElement(q,null),document.getElementById("reservation_stylist")),E=React.render(React.createElement(u,null),document.getElementById("service_category")),F=React.render(React.createElement(v,null),document.getElementById("service_list_info")),G=React.render(React.createElement(w,null),document.getElementById("service_list_info2")),H=getSessionInfo(),I=a(),J=-1,K=!1;if(null!=I.reservationId){K=!0,J=I.reservationId;var L=getReservationInfo({t_reservation_id:J});if(null!=L){var M=L.t_reservation_date;console.log("param_time:"+L.t_reservation_date);var N=Number(moment(M).month())+1,O=moment(M).year()+"/"+N+"/"+moment(M).date(),P=Number(moment(M).hours())<10?"0"+moment(M).hours():moment(M).hours(),Q=Number(moment(M).minutes())<10?"0"+moment(M).minutes():moment(M).minutes();f=P+":"+Q,g=f,h=f;var R=L.t_reservation_stylistId,S=getUserInfo({t_user_tel:L.t_reservation_userTel});z.setState({t_user_tel:S.t_user_tel}),A.setState({t_user_id:S.t_user_id,t_user_name:S.t_user_name}),B.setState({t_user_gender:S.t_user_gender}),C.setState({t_user_age:S.t_user_age});var T=L.t_reservation_menuId}}else{var M=I.time,O=M.substring(0,10);f=M.substring(13,18),g=f,h=f;var R=I.stylistId;console.log("Parameters: "+O+" "+f+"-"+h+" ,"+R)}var U=getServiceCategoryList();sanitaize.decode(U);var V=(U.category,getMenuInfo({t_hairSalonMaster_salonId:H.t_hairSalonMaster_salonId}));sanitaize.decode(V);for(var W=new Array,X=0;X<V.menu.length;X++){var Y=V.menu[X].t_menu_id,Z=V.menu[X].t_menu_name;W[Y]=Z}var _=function(a){for(var b=[],c=0;c<V.menu.length;c++)V.menu[c].t_menu_categoryId==a&&b.push({t_menu_categoryId:V.menu[c].t_menu_categoryId,t_menu_menuId:V.menu[c].t_menu_menuId,t_menu_name:V.menu[c].t_menu_name,t_menu_price:V.menu[c].t_menu_price,t_menu_time:V.menu[c].t_menu_time});return 0==b.length&&b.push({t_menu_categoryId:"",t_menu_menuId:"",t_menu_name:"",t_menu_price:"",t_menu_time:""}),b},aa=getStylistList({t_hairSalonMaster_salonId:H.t_hairSalonMaster_salonId});sanitaize.decode(aa);for(var ba=new Array,X=0;X<aa.stylist.length;X++){var ca=aa.stylist[X].t_stylist_Id,da=aa.stylist[X].t_stylist_name;ba[ca]=da}$("#date").datepicker({format:"yyyy/mm/dd",language:"ja",autoclose:!0,orientation:"top auto"}),$("#date").datepicker("setDate",O),x.setState({t_reservation_start:f}),y.setState({t_reservation_end:h}),D.setProps({stylist:aa.stylist}),D.setState({t_stylist_id:R}),E.setProps({category:U.category}),E.setState({t_menu_categoryId:E.props.category[0].t_menuCategory_categoryId});var ea=_(1);F.setState({service_list:ea});var fa=[],ga=0,ha=0;if(K){for(var ia=T.split(","),X=0;X<ia.length;X++)for(var ja=0;ja<V.menu.length;ja++)if(ia[X]==V.menu[ja].t_menu_menuId){fa.push({t_menu_menuId:ia[X],t_menu_name:V.menu[ja].t_menu_name,t_menu_start:g,t_menu_time:V.menu[ja].t_menu_time,t_menu_stylist:ba[R],t_menu_seat:"",t_menu_price:V.menu[ja].t_menu_price}),ga+=Number(V.menu[ja].t_menu_price),ha+=Number(V.menu[ja].t_menu_time);var ka=b(f,ha);g=b(f,ha),y.setState({t_reservation_end:ka})}G.setState({service_list2:fa})}$("#account-name").text(H.t_hairSalonMaster_contactUserName),$("#search_button").on("click",function(){if(""!=z.state.t_user_tel&&null!=z.state.t_user_tel){var a=getUserInfo({t_user_tel:z.state.t_user_tel});a.t_user_id>0?(B.setState({t_user_gender:a.t_user_gender}),A.setState({t_user_id:a.t_user_id,t_user_name:a.t_user_name}),C.setState({t_user_age:a.t_user_age})):alert("Unregisted PhoneNumber")}}),$(".reserve").on("click",function(){for(var a=$(".reserve").index(this),c=!1,d=0;d<fa.length;d++)fa[d].t_menu_menuId==F.state.service_list[a].t_menu_menuId&&(c=!0);if(0==c){fa.push({t_menu_menuId:F.state.service_list[a].t_menu_menuId,t_menu_name:F.state.service_list[a].t_menu_name,t_menu_start:g,t_menu_time:F.state.service_list[a].t_menu_time,t_menu_stylist:ba[D.state.t_stylist_id],t_menu_seat:"",t_menu_price:F.state.service_list[a].t_menu_price}),ga+=Number(F.state.service_list[a].t_menu_price),ha+=Number(F.state.service_list[a].t_menu_time);var e=b(f,ha);g=b(f,ha),y.setState({t_reservation_end:e})}G.setState({service_list2:fa})}),$(".delete").on("click",function(){var a=$(".delete").index(this);console.log("d_id:"+a);for(var b=0;b<fa.length;b++)fa[b].t_menu_menuId==G.state.service_list2[a].t_menu_menuId&&(console.log(fa[b].t_menu_name+","+G.state.service_list2[a].t_menu_price),ga-=Number(G.state.service_list2[a].t_menu_price),ha-=Number(G.state.service_list2[a].t_menu_time),fa.splice(b,1));G.setState({service_list2:fa})}),$("#regist").on("click",function(){for(var a=moment($("#date").datepicker("getDate")),d=Number(a.month())+1,e=a.year()+"/"+d+"/"+a.date()+" "+x.state.t_reservation_start,f=0,g=0;g<fa.length;g++)for(var h=0;h<V.length;h++)fa[g].t_menu_menuId==V.menu[h].t_menu_id&&(f+=V.menu[h].t_menu_time);if(0>J){var i=getReservationList({t_reservation_salonId:H.t_hairSalonMaster_salonId,t_reservation_date:M}),j=[];if(j=i.reservation_lists,void 0==j)console.log("No reservation.");else for(var g=0;g<j.length;g++)if(console.log(e.substring(0,10)+","+j[g].t_reservation_date.substring(0,10)),e.substring(0,10)==j[g].t_reservation_date.substring(0,10)){for(var k="",h=0;h<aa.stylist.length;h++)aa.stylist[h].t_stylist_id==D.state.t_stylist_id&&(k=aa.stylist[h].t_stylist_name);if(k==j.t_stylist_name){var l=j[g].t_reservation_date.substring(13,18),m=b(st,j[g].t_reservation_time),n=x.state.t_reservation_start,o=b(n,f);console.log(l+","+m+","+n+","+o);var p=c(l,m,n,o);if(p)return}}}var q=function(){for(var a="",b=0;b<fa.length;b++)a+=fa[b].t_menu_menuId+",";return a.length>0&&(a=a.substring(0,a.length-1)),console.log(a),a},r=function(){var a=-1;return a=A.state.t_user_id,console.log("uid:"+a),""==a&&(ui=setRegistUser({t_user_name:A.state.t_user_name,t_user_gender:B.state.t_user_gender,t_user_tel:z.state.t_user_tel,t_user_age:C.state.t_user_age}),a=ui.t_user_id),a},s={t_reservation_userId:r,t_reservation_salonId:H.t_hairSalonMaster_salonId,t_reservation_stylistId:D.state.t_stylist_id,t_reservation_date:e,t_reservation_menuId:q,t_reservation_seatId:1,t_reservation_memo:$("#memo").text()};sanitaize.encode(s);var p=setReservationInfo(s);"true"==p.result?(alert("Regist Success"),window.location.reload()):alert("Regist Failed")}),$(function(){$("button",".jquery-ui-button").button(),$("#jquery-ui-dialog-opener").click(function(){$("#jquery-ui-dialog").dialog("open")});var a=($("#jquery-ui-dialog-form-name"),$("#jquery-ui-dialog-form-comment"));$("#jquery-ui-dialog").dialog({autoOpen:!1,width:350,show:"explode",hide:"explode",modal:!0,buttons:{"登録":function(){a.val()&&(function(a){return 0}&&d(a.val()),$(this).dialog("close")),$(this).dialog("close")},"キャンセル":function(){$(this).dialog("close")}}})}),$("#come").on("click",function(){e(1)}),$("#cancel").on("click",function(){$("#dialogdemo1").dialog("open")}),$("#dialogdemo1").dialog({autoOpen:!1,title:"予約取消",closeOnEscape:!1,modal:!0,buttons:{"連絡あり":function(){e(2),$(this).dialog("close")},"連絡なし":function(){e(3),$(this).dialog("close")}}})});