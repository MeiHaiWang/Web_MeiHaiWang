$(function(){function a(){var a=location.href;parameters=a.split("?"),params=parameters[1].split("&");var b=[];for(S=0;S<params.length;S++)neet=params[S].split("="),b.push(neet[0]),b[neet[0]]=neet[1];return b}function b(a,b){var c=a,d=Number(c.substring(0,2)),e=Number(c.substring(3,5));ope_hours=Math.floor(b/60),ope_minutes=b%60;var f=d+ope_hours,g=e+ope_minutes;g>=60&&(g-=60,f+=1);var h=10>f?"0"+f:f,i=10>g?"0"+g:g,j=h+":"+i;return console.log("start_time="+c+", total_time="+b+", end_time="+j),j}function c(a,b,c,d){var e=!0,f=a.substring(0,2),g=a.substring(3,5),h=b.substring(0,2),i=b.substring(3,5),j=c.substring(0,2),k=c.substring(3,5),l=d.substring(0,2),m=d.substring(3,5);if(Number(f)<Number(j))Number(h)<Number(j)?e=!1:Number(h)>Number(j)?e=!0:Number(h)==Number(j)&&(Number(i)<Number(k)?e=!1:Number(i)>Number(k)?e=!0:Number(i)==Number(k)&&(e=!1));else if(Number(f)>Number(j)){if(Number(f)>Number(l))return!1;if(Number(f)<Number(l))return!0;Number(f)==Number(l)&&(Number(g)>Number(m)?e=!1:Number(g)<Number(m)?e=!0:Number(g)==Number(m)&&(e=!1))}else Number(f)==Number(j)&&(e=!0);return e}function d(a){var b={t_claim_reservationId:E,t_claim_userId:v.state.t_user_id,t_claim_salonId:C.t_hairSalonMaster_salonId,t_claim_menuId:0,t_claim_date:H,t_claim_message:a};sanitaize.encode(b);var c=setClaim(b);"true"==c.result?(alert("Regist Success"),window.location.reload()):alert("Regist Failed")}function e(a){if(!(0>E)){var b={t_reservation_id:E,t_reservation_isFinished:a};sanitaize.encode(b);var c=setReservationFinish(b);"true"==c.result?(alert("Regist Success"),window.location.reload()):alert("Regist Failed")}}var f,g,h,i=React.createClass({displayName:"ReservationStartTime",getDefaultProps:function(){return{t_reservation_start:[""]}},getInitialState:function(){return{t_reservation_start:""}},onChangeSelectValue:function(a){this.setState({t_reservation_start:a.target.value})},render:function(){return React.createElement("input",{type:"text",value:this.state.t_reservation_start,onChange:this.changeText})}}),j=React.createClass({displayName:"ReservationEndTime",getDefaultProps:function(){return{t_reservation_end:[""]}},getInitialState:function(){return{t_reservation_end:""}},onChangeSelectValue:function(a){this.setState({t_reservation_end:a.target.value})},render:function(){return React.createElement("input",{type:"text",value:this.state.t_reservation_end,onChange:this.changeText})}}),k=React.createClass({displayName:"ReservationUserTel",getInitialState:function(){return{t_user_tel:""}},changeText:function(a){this.setState({t_user_tel:a.target.value})},render:function(){return React.createElement("div",null,React.createElement("input",{type:"text",value:this.state.t_user_tel,onChange:this.changeText,placeholder:"電話番号"}))}}),l=React.createClass({displayName:"ReservationUserName",getInitialState:function(){return{t_user_id:"",t_user_name:""}},changeText:function(a){this.setState({t_user_name:a.target.value})},render:function(){return React.createElement("div",null,React.createElement("input",{type:"text",value:this.state.t_user_name,onChange:this.changeText}))}}),m=React.createClass({displayName:"ReservationUserGender",getInitialState:function(){return{t_user_gender:"0"}},onChangeSelectValue:function(a){this.setState({t_user_gender:a.target.value})},render:function(){return React.createElement("div",null,React.createElement("select",{value:this.state.t_user_gender,onChange:this.onChangeSelectValue},React.createElement("option",{value:"0"},"男性"),React.createElement("option",{value:"1"},"女性")))}}),n=React.createClass({displayName:"ReservationUserAge",getInitialState:function(){return{t_user_age:""}},changeText:function(a){this.setState({t_user_age:a.target.value})},render:function(){return React.createElement("div",null,React.createElement("input",{type:"text",value:this.state.t_user_age,onChange:this.changeText}))}}),o=React.createClass({displayName:"ReservationStylist",getDefaultProps:function(){return{stylist:[""]}},getInitialState:function(){return{t_stylist_id:""}},onChangeSelectValue:function(a){this.setState({t_stylist_id:a.target.value})},render:function(){var a=this.props.stylist.map(function(a){return React.createElement("option",{value:a.t_stylist_stylist_id},a.t_stylist_name)});return React.createElement("div",null,React.createElement("select",{value:this.state.t_stylist_id,onChange:this.onChangeSelectValue},a))}}),p=React.createClass({displayName:"ServiceCategory",getDefaultProps:function(){return{category:[""]}},getInitialState:function(){return{t_menu_categoryId:""}},onChangeSelectValue:function(a){var b=V(a.target.value);A.setState({service_list:b}),this.setState({t_menu_categoryId:a.target.value})},render:function(){var a=this.props.category.map(function(a){return React.createElement("option",{value:a.t_menuCategory_categoryId},a.t_menuCategory_name)});return React.createElement("div",null,React.createElement("select",{value:this.state.t_menu_categoryId,onChange:this.onChangeSelectValue},a))}}),q=React.createClass({displayName:"ServiceList",getInitialState:function(){return{service_list:[{t_menu_categoryId:"",t_menu_menuId:"",t_menu_name:"",t_menu_price:"",t_menu_time:""}]}},render:function(){var a=this.state.service_list.map(function(a){return React.createElement("tr",null,React.createElement("td",null,a.t_menu_name),React.createElement("td",null,a.t_menu_time),React.createElement("td",null,a.t_menu_price),React.createElement("td",null,React.createElement("a",{className:"reserve"},"予約")))});return React.createElement("div",null,React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"服务名称"),React.createElement("th",null,"Time"),React.createElement("th",null,"Price"),React.createElement("th",null,"予約"))),React.createElement("tbody",null,a,React.createElement("tr",null))))}}),r=React.createClass({displayName:"ServiceList2",getInitialState:function(){return{service_list2:[{t_menu_menuId:"",t_menu_name:"",t_menu_start:"",t_menu_time:"",t_menu_stylist:"",t_menu_seat:"",t_menu_price:""}]}},render:function(){var a=this.state.service_list2.map(function(a){return React.createElement("tr",null,React.createElement("td",null,a.t_menu_name),React.createElement("td",null,a.t_menu_start),React.createElement("td",null,a.t_menu_time),React.createElement("td",null,a.t_menu_stylist),React.createElement("td",null,a.t_menu_seat),React.createElement("td",null,React.createElement("a",{className:"delete"},"削除")))});return React.createElement("div",null,React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"服务名称"),React.createElement("th",null,"Start"),React.createElement("th",null,"Time"),React.createElement("th",null,"Stylist"),React.createElement("th",null,"Seat"),React.createElement("th",null,"削除"))),React.createElement("tbody",null,a)))}}),s=React.render(React.createElement(i,null),document.getElementById("reservation_start")),t=React.render(React.createElement(j,null),document.getElementById("reservation_end")),u=React.render(React.createElement(k,null),document.getElementById("reservation_user_tel")),v=React.render(React.createElement(l,null),document.getElementById("reservation_user_name")),w=React.render(React.createElement(m,null),document.getElementById("reservation_user_sex")),x=React.render(React.createElement(n,null),document.getElementById("reservation_user_age")),y=React.render(React.createElement(o,null),document.getElementById("reservation_stylist")),z=React.render(React.createElement(p,null),document.getElementById("service_category")),A=React.render(React.createElement(q,null),document.getElementById("service_list_info")),B=React.render(React.createElement(r,null),document.getElementById("service_list_info2")),C=getSessionInfo(),D=a(),E=-1,F=!1;if(null!=D.reservationId){F=!0,E=D.reservationId;var G=getReservationInfo({t_reservation_id:E});if(null!=G){var H=G.t_reservation_date;console.log("param_time:"+G.t_reservation_date);var I=Number(moment(H).month())+1,J=moment(H).year()+"/"+I+"/"+moment(H).date(),K=Number(moment(H).hours())<10?"0"+moment(H).hours():moment(H).hours(),L=Number(moment(H).minutes())<10?"0"+moment(H).minutes():moment(H).minutes();f=K+":"+L,g=f,h=f;var M=G.t_reservation_stylistId,N=getUserInfo({t_user_tel:G.t_reservation_userTel});u.setState({t_user_tel:N.t_user_tel}),v.setState({t_user_id:N.t_user_id,t_user_name:N.t_user_name}),w.setState({t_user_gender:N.t_user_gender}),x.setState({t_user_age:N.t_user_age});var O=G.t_reservation_menuId}}else{var H=D.time,J=H.substring(0,10);f=H.substring(13,18),g=f,h=f;var M=D.stylistId;console.log("Parameters: "+J+" "+f+"-"+h+" ,"+M)}var P=getServiceCategoryList();sanitaize.decode(P);var Q=(P.category,getMenuInfo({t_hairSalonMaster_salonId:C.t_hairSalonMaster_salonId}));sanitaize.decode(Q);for(var R=new Array,S=0;S<Q.menu.length;S++){var T=Q.menu[S].t_menu_id,U=Q.menu[S].t_menu_name;R[T]=U}var V=function(a){for(var b=[],c=0;c<Q.menu.length;c++)Q.menu[c].t_menu_categoryId==a&&b.push({t_menu_categoryId:Q.menu[c].t_menu_categoryId,t_menu_menuId:Q.menu[c].t_menu_menuId,t_menu_name:Q.menu[c].t_menu_name,t_menu_price:Q.menu[c].t_menu_price,t_menu_time:Q.menu[c].t_menu_time});return 0==b.length&&b.push({t_menu_categoryId:"",t_menu_menuId:"",t_menu_name:"",t_menu_price:"",t_menu_time:""}),b},W=getStylistList({t_hairSalonMaster_salonId:C.t_hairSalonMaster_salonId});sanitaize.decode(W);for(var X=new Array,S=0;S<W.stylist.length;S++){var Y=W.stylist[S].t_stylist_stylist_id,Z=W.stylist[S].t_stylist_name;X[Y]=Z}$("#date").datepicker({format:"yyyy/mm/dd",language:"ja",autoclose:!0,orientation:"top auto"}),$("#date").datepicker("setDate",J),s.setState({t_reservation_start:f}),t.setState({t_reservation_end:h}),y.setProps({stylist:W.stylist}),y.setState({t_stylist_id:M}),z.setProps({category:P.category}),z.setState({t_menu_categoryId:z.props.category[0].t_menuCategory_categoryId});var _=V(1);A.setState({service_list:_});var aa=[],ba=0,ca=0;if(F){for(var da=O.split(","),S=0;S<da.length;S++)for(var ea=0;ea<Q.menu.length;ea++)if(da[S]==Q.menu[ea].t_menu_menuId){aa.push({t_menu_menuId:da[S],t_menu_name:Q.menu[ea].t_menu_name,t_menu_start:g,t_menu_time:Q.menu[ea].t_menu_time,t_menu_stylist:X[M],t_menu_seat:"",t_menu_price:Q.menu[ea].t_menu_price}),ba+=Number(Q.menu[ea].t_menu_price),ca+=Number(Q.menu[ea].t_menu_time);var fa=b(f,ca);g=b(f,ca),t.setState({t_reservation_end:fa})}B.setState({service_list2:aa})}$("#account-name").text(C.t_hairSalonMaster_contactUserName),$("#search_button").on("click",function(){if(""!=u.state.t_user_tel&&null!=u.state.t_user_tel){var a=getUserInfo({t_user_tel:u.state.t_user_tel});a.t_user_id>0?(w.setState({t_user_gender:a.t_user_gender}),v.setState({t_user_id:a.t_user_id,t_user_name:a.t_user_name}),x.setState({t_user_age:a.t_user_age})):alert("Unregisted PhoneNumber")}}),$(".reserve").on("click",function(){for(var a=$(".reserve").index(this),c=!1,d=0;d<aa.length;d++)aa[d].t_menu_menuId==A.state.service_list[a].t_menu_menuId&&(c=!0);if(0==c){aa.push({t_menu_menuId:A.state.service_list[a].t_menu_menuId,t_menu_name:A.state.service_list[a].t_menu_name,t_menu_start:g,t_menu_time:A.state.service_list[a].t_menu_time,t_menu_stylist:X[y.state.t_stylist_id],t_menu_seat:"",t_menu_price:A.state.service_list[a].t_menu_price}),ba+=Number(A.state.service_list[a].t_menu_price),ca+=Number(A.state.service_list[a].t_menu_time);var e=b(f,ca);g=b(f,ca),t.setState({t_reservation_end:e})}B.setState({service_list2:aa})}),$(".delete").on("click",function(){var a=$(".delete").index(this);console.log("d_id:"+a);for(var b=0;b<aa.length;b++)aa[b].t_menu_menuId==B.state.service_list2[a].t_menu_menuId&&(console.log(aa[b].t_menu_name+","+B.state.service_list2[a].t_menu_price),ba-=Number(B.state.service_list2[a].t_menu_price),ca-=Number(B.state.service_list2[a].t_menu_time),aa.splice(b,1));B.setState({service_list2:aa})}),$("#regist").on("click",function(){for(var a=moment($("#date").datepicker("getDate")),d=Number(a.month())+1,e=a.year()+"/"+d+"/"+a.date()+" "+s.state.t_reservation_start,f=0,g=0;g<aa.length;g++)for(var h=0;h<Q.length;h++)aa[g].t_menu_menuId==Q.menu[h].t_menu_id&&(f+=Q.menu[h].t_menu_time);if(0>E){var i=getReservationList({t_reservation_salonId:C.t_hairSalonMaster_salonId,t_reservation_date:H}),j=[];if(j=i.reservation_lists,void 0==j)console.log("No reservation.");else for(var g=0;g<j.length;g++)if(console.log(e.substring(0,10)+","+j[g].t_reservation_date.substring(0,10)),e.substring(0,10)==j[g].t_reservation_date.substring(0,10)){for(var k="",h=0;h<W.stylist.length;h++)W.stylist[h].t_stylist_id==y.state.t_stylist_id&&(k=W.stylist[h].t_stylist_name);if(k==j.t_stylist_name){var l=j[g].t_reservation_date.substring(13,18),m=b(st,j[g].t_reservation_time),n=s.state.t_reservation_start,o=b(n,f);console.log(l+","+m+","+n+","+o);var p=c(l,m,n,o);if(p)return}}}var q=function(){for(var a="",b=0;b<aa.length;b++)a+=aa[b].t_menu_menuId+",";return a.length>0&&(a=a.substring(0,a.length-1)),console.log(a),a},r=function(){var a=-1;return a=v.state.t_user_id,console.log("uid:"+a),""==a&&(ui=setRegistUser({t_user_name:v.state.t_user_name,t_user_gender:w.state.t_user_gender,t_user_tel:u.state.t_user_tel,t_user_age:x.state.t_user_age}),a=ui.t_user_id),a},t={t_reservation_userId:r,t_reservation_salonId:C.t_hairSalonMaster_salonId,t_reservation_stylistId:y.state.t_stylist_id,t_reservation_date:e,t_reservation_menuId:q,t_reservation_seatId:1,t_reservation_memo:$("#memo").text()};sanitaize.encode(t);var p=setReservationInfo(t);"true"==p.result?(alert("Regist Success"),window.location.reload()):alert("Regist Failed")}),$(function(){$("button",".jquery-ui-button").button(),$("#jquery-ui-dialog-opener").click(function(){$("#jquery-ui-dialog").dialog("open")});var a=($("#jquery-ui-dialog-form-name"),$("#jquery-ui-dialog-form-comment"));$("#jquery-ui-dialog").dialog({autoOpen:!1,width:350,show:"explode",hide:"explode",modal:!0,buttons:{"登録":function(){a.val()&&(function(a){return 0}&&d(a.val()),$(this).dialog("close")),$(this).dialog("close")},"キャンセル":function(){$(this).dialog("close")}}})}),$("#come").on("click",function(){e(1)}),$("#cancel").on("click",function(){$("#dialogdemo1").dialog("open")}),$("#dialogdemo1").dialog({autoOpen:!1,title:"予約取消",closeOnEscape:!1,modal:!0,buttons:{"連絡あり":function(){e(2),$(this).dialog("close")},"連絡なし":function(){e(3),$(this).dialog("close")}}})});