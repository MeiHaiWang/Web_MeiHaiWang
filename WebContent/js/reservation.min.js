$(function(){function a(){var a=location.href;parameters=a.split("?"),params=parameters[1].split("&");var b=[];for(Y=0;Y<params.length;Y++)neet=params[Y].split("="),b.push(neet[0]),b[neet[0]]=neet[1];return b}function b(a,b){var c=a,d=Number(c.substring(0,2)),e=Number(c.substring(3,5));ope_hours=Math.floor(b/60),ope_minutes=b%60;var f=d+ope_hours,g=e+ope_minutes;g>=60&&(g-=60,f+=1);var h=10>f?"0"+f:f,i=10>g?"0"+g:g,j=h+":"+i;return j}function c(a,b,c,d){var e=!0,f=a.substring(0,2),g=a.substring(3,5),h=b.substring(0,2),i=b.substring(3,5),j=c.substring(0,2),k=c.substring(3,5),l=d.substring(0,2),m=d.substring(3,5);if(Number(f)<Number(j))Number(h)<Number(j)?e=!1:Number(h)>Number(j)?e=!0:Number(h)==Number(j)&&(Number(i)<Number(k)?e=!1:Number(i)>Number(k)?e=!0:Number(i)==Number(k)&&(e=!1));else if(Number(f)>Number(j)){if(Number(f)>Number(l))return!1;if(Number(f)<Number(l))return!0;Number(f)==Number(l)&&(Number(g)>Number(m)?e=!1:Number(g)<Number(m)?e=!0:Number(g)==Number(m)&&(e=!1))}else Number(f)==Number(j)&&(e=!0);return e}function d(a){var b={t_claim_reservationId:J,t_claim_userId:A.state.t_user_id,t_claim_salonId:H.t_hairSalonMaster_salonId,t_claim_menuId:0,t_claim_date:M,t_claim_message:a};sanitaize.encode(b);var c=setClaim(b);"true"==c.result?(alert("Regist Success"),window.location.reload()):alert("Regist Failed")}function e(a){if(0>J)return void alert("予約情報が把握できません.");var b={t_reservation_id:J,t_reservation_isFinished:a};sanitaize.encode(b);var c=setReservationFinish(b);"true"==c.result?(alert("Regist Success"),window.location.reload()):alert("Regist Failed")}var f,g,h,i=ReactBootstrap.Input,j=React.createClass({displayName:"ReservationStartTime",getDefaultProps:function(){return{t_reservation_start:[""]}},getInitialState:function(){return{t_reservation_start:""}},changeText:function(a){this.setState({t_reservation_start:a.target.value})},render:function(){return React.createElement(i,{type:"text",value:this.state.t_reservation_start,onChange:this.changeText})}}),k=React.createClass({displayName:"ReservationEndTime",getDefaultProps:function(){return{t_reservation_end:[""]}},getInitialState:function(){return{t_reservation_end:""}},onChangeSelectValue:function(a){this.setState({t_reservation_end:a.target.value})},render:function(){return React.createElement(i,{type:"text",value:this.state.t_reservation_end,onChange:this.changeText,disabled:!0})}}),l=React.createClass({displayName:"ReservationUserTel",getInitialState:function(){return{t_user_tel:"",reserveId:-1}},changeText:function(a){this.setState({t_user_tel:a.target.value})},render:function(){var a=function(){var a;return a=this.state.reserveId<0?React.createElement(i,{type:"text",value:this.state.t_user_tel,onChange:this.changeText,placeholder:"電話番号"}):React.createElement(i,{type:"text",value:this.state.t_user_tel,onChange:this.changeText,placeholder:"電話番号",disabled:!0})}.bind(this)();return React.createElement("div",null,a)}}),m=React.createClass({displayName:"ReservationUserName",getInitialState:function(){return{t_user_id:"",t_user_name:"",reserveId:-1}},changeText:function(a){this.setState({t_user_name:a.target.value})},render:function(){var a=function(){var a;return a=this.state.reserveId<0?React.createElement(i,{type:"text",value:this.state.t_user_name,onChange:this.changeText}):React.createElement(i,{type:"text",value:this.state.t_user_name,onChange:this.changeText,disabled:!0})}.bind(this)();return React.createElement("div",null,a)}}),n=React.createClass({displayName:"ReservationUserGender",getInitialState:function(){return{t_user_gender:"0",reserveId:-1}},onChangeSelectValue:function(a){this.setState({t_user_gender:a.target.value})},render:function(){var a=function(){var a;return a=this.state.reserveId<0?React.createElement("select",{value:this.state.t_user_gender,onChange:this.onChangeSelectValue},React.createElement("option",{value:"0"},"男性"),React.createElement("option",{value:"1"},"女性")):React.createElement("select",{value:this.state.t_user_gender,onChange:this.onChangeSelectValue,disabled:!0},React.createElement("option",{value:"0"},"男性"),React.createElement("option",{value:"1"},"女性"))}.bind(this)();return React.createElement("div",null,a)}}),o=function(){for(var a=[],b=10;70>=b;b++)a.push(b);return a}(),p=React.createClass({displayName:"ReservationUserAge",getDefaultProps:function(){return{t_user_age:o}},getInitialState:function(){return{t_user_age:"20",reserveId:-1}},onChangeSelectValue:function(a){this.setState({t_user_age:a.target.value})},render:function(){var a=this.props.t_user_age.map(function(a){return React.createElement("option",{value:a},a)}),b=function(){var b;return b=this.state.reserveId<0?React.createElement("select",{value:this.state.t_user_age,onChange:this.onChangeSelectValue},a):React.createElement("select",{value:this.state.t_user_age,onChange:this.onChangeSelectValue,disabled:!0},a)}.bind(this)(),c=React.createElement("div",null,b);return React.createElement("div",null,c)}}),q=React.createClass({displayName:"ReservationStylist",getDefaultProps:function(){return{stylist:[""]}},getInitialState:function(){return{t_stylist_id:""}},onChangeSelectValue:function(a){this.setState({t_stylist_id:a.target.value})},render:function(){var a=this.props.stylist.map(function(a){return React.createElement("option",{value:a.t_stylist_Id},a.t_stylist_name)});return React.createElement("div",null,React.createElement("select",{value:this.state.t_stylist_id,onChange:this.onChangeSelectValue},a))}}),r=ReactBootstrap.Nav,s=ReactBootstrap.Navbar,t=ReactBootstrap.NavItem,u=(ReactBootstrap.Button,React.createClass({displayName:"ServiceCategory",getDefaultProps:function(){return{category:[""]}},getInitialState:function(){return{t_menu_categoryId:""}},handleSelect:function(a){var b=aa(a);F.setState({service_list:b}),this.setState({t_menu_categoryId:a})},render:function(){for(var a=[],b=[],c=0;c<this.props.category.length;c++)6>c?a.push(this.props.category[c]):b.push(this.props.category[c]);var d=a.map(function(a){return React.createElement(t,{bsSize:"xsmall",eventKey:a.t_menuCategory_categoryId},a.t_menuCategory_name)}),e=b.map(function(a){return React.createElement(t,{bsSize:"xsmall",eventKey:a.t_menuCategory_categoryId},a.t_menuCategory_name)});return React.createElement("div",null,React.createElement(s,{bsStyle:"warning"},React.createElement(r,{activeKey:this.state.t_menu_categoryId,onSelect:this.handleSelect},d)),React.createElement(s,{bsStyle:"warning"},React.createElement(r,{activeKey:this.state.t_menu_categoryId,onSelect:this.handleSelect},e)))}})),v=React.createClass({displayName:"ServiceList",getInitialState:function(){return{service_list:[{t_menu_categoryId:"",t_menu_menuId:"",t_menu_name:"",t_menu_price:"",t_menu_time:""}]}},render:function(){var a=this.state.service_list.map(function(a){return React.createElement("tr",null,React.createElement("td",null,a.t_menu_name),React.createElement("td",null,a.t_menu_time),React.createElement("td",null,a.t_menu_price),React.createElement("td",null,React.createElement("a",{className:"reserve"},"予約")))});return React.createElement("div",null,React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"服务名称"),React.createElement("th",null,"Time"),React.createElement("th",null,"Price"),React.createElement("th",null,"予約"))),React.createElement("tbody",null,a,React.createElement("tr",null))))}}),w=React.createClass({displayName:"ServiceList2",getInitialState:function(){return{service_list2:[{t_menu_menuId:"",t_menu_name:"",t_menu_start:"",t_menu_time:"",t_menu_stylist:"",t_menu_seat:"",t_menu_price:""}]}},render:function(){var a=this.state.service_list2.map(function(a){return React.createElement("tr",null,React.createElement("td",null,a.t_menu_name),React.createElement("td",null,a.t_menu_start),React.createElement("td",null,a.t_menu_time),React.createElement("td",null,a.t_menu_stylist),React.createElement("td",null,a.t_menu_seat),React.createElement("td",null,React.createElement("a",{className:"delete"},"削除")))});return React.createElement("div",null,React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"服务名称"),React.createElement("th",null,"Start"),React.createElement("th",null,"Time"),React.createElement("th",null,"Stylist"),React.createElement("th",null,"Seat"),React.createElement("th",null,"削除"))),React.createElement("tbody",null,a)))}}),x=React.render(React.createElement(j,null),document.getElementById("reservation_start")),y=React.render(React.createElement(k,null),document.getElementById("reservation_end")),z=React.render(React.createElement(l,null),document.getElementById("reservation_user_tel")),A=React.render(React.createElement(m,null),document.getElementById("reservation_user_name")),B=React.render(React.createElement(n,null),document.getElementById("reservation_user_sex")),C=React.render(React.createElement(p,null),document.getElementById("reservation_user_age")),D=React.render(React.createElement(q,null),document.getElementById("reservation_stylist")),E=React.render(React.createElement(u,null),document.getElementById("service_menu_category")),F=React.render(React.createElement(v,null),document.getElementById("service_menu_list_info")),G=React.render(React.createElement(w,null),document.getElementById("service_menu_list_info2")),H=getSessionInfo(),I=a(),J=-1,K=!1;if(null!=I.reservationId){K=!0,J=I.reservationId;var L=getReservationInfo({t_reservation_id:J});if(null!=L){var M=L.t_reservation_date,N=Number(moment(M).month())+1,O=moment(M).year()+"-"+N+"-"+moment(M).date(),P=Number(moment(M).hours())<10?"0"+moment(M).hours():moment(M).hours(),Q=Number(moment(M).minutes())<10?"0"+moment(M).minutes():moment(M).minutes();f=P+":"+Q,g=f,h=f;var R=L.t_reservation_stylistId,S=getUserInfo({t_user_tel:L.t_reservation_userTel});z.setState({t_user_tel:S.t_user_tel,reserveId:J}),A.setState({t_user_id:S.t_user_id,t_user_name:S.t_user_name,reserveId:J}),B.setState({t_user_gender:S.t_user_gender,reserveId:J}),C.setState({t_user_age:S.t_user_age,reserveId:J});var T=L.t_reservation_menuId;1==L.t_reservation_appoint&&$("#appoint").prop("checked",!0)}}else{var M=I.time,O=M.substring(0,10);f=M.substring(13,18),g=f,h=f;var R=I.stylistId;console.log("Parameters: "+O+" "+f+"-"+h+" ,"+R)}var U=getServiceCategoryList();sanitaize.decode(U);var V=U.category;V.push({t_menuCategory_categoryId:"R",t_menuCategory_name:"休憩"});var W=getMenuInfo({t_hairSalonMaster_salonId:H.t_hairSalonMaster_salonId});sanitaize.decode(W),W.menu.push({t_menu_menuId:"R1",t_menu_name:"休憩",t_menu_time:"60"}),W.menu.push({t_menu_menuId:"R2",t_menu_name:"休暇",t_menu_time:"ALLDAY"});for(var X=new Array,Y=0;Y<W.menu.length;Y++){var Z=W.menu[Y].t_menu_menuId,_=W.menu[Y].t_menu_name;X[Z]=_}var aa=function(a){var b=[];if("R"==a)return b.push({t_menu_categoryId:"R",t_menu_menuId:"R1",t_menu_name:"休憩",t_menu_price:"0",t_menu_time:"60"}),b.push({t_menu_categoryId:"R",t_menu_menuId:"R2",t_menu_name:"休暇",t_menu_price:"0",t_menu_time:"ALLDAY"}),b;for(var c=0;c<W.menu.length;c++)W.menu[c].t_menu_categoryId==a&&b.push({t_menu_categoryId:W.menu[c].t_menu_categoryId,t_menu_menuId:W.menu[c].t_menu_menuId,t_menu_name:W.menu[c].t_menu_name,t_menu_price:W.menu[c].t_menu_price,t_menu_time:W.menu[c].t_menu_time});return 0==b.length&&b.push({t_menu_categoryId:"",t_menu_menuId:"",t_menu_name:"",t_menu_price:"",t_menu_time:""}),b},ba=getStylistList({t_hairSalonMaster_salonId:H.t_hairSalonMaster_salonId});sanitaize.decode(ba);for(var ca=new Array,Y=0;Y<ba.stylist.length;Y++){var da=ba.stylist[Y].t_stylist_Id,ea=ba.stylist[Y].t_stylist_name;ca[da]=ea}$("#date").datepicker({dateFormat:"yy-mm-dd",language:"ja",autoclose:!0,orientation:"top auto"}),$("#date").datepicker("setDate",O),x.setState({t_reservation_start:f}),y.setState({t_reservation_end:h}),D.setProps({stylist:ba.stylist}),D.setState({t_stylist_id:R}),E.setProps({category:U.category}),E.setState({t_menu_categoryId:E.props.category[0].t_menuCategory_categoryId});var fa=aa(1);F.setState({service_list:fa});var ga=[],ha=0,ia=0;if(K){for(var ja=T.split(","),Y=0;Y<ja.length;Y++)for(var ka=0;ka<W.menu.length;ka++)if(ja[Y]==W.menu[ka].t_menu_menuId){ga.push({t_menu_menuId:ja[Y],t_menu_name:W.menu[ka].t_menu_name,t_menu_start:g,t_menu_time:W.menu[ka].t_menu_time,t_menu_stylist:ca[R],t_menu_seat:"",t_menu_price:W.menu[ka].t_menu_price}),ha+=Number(W.menu[ka].t_menu_price),ia+=Number(W.menu[ka].t_menu_time);var la=b(f,ia);g=b(f,ia),y.setState({t_reservation_end:la})}G.setState({service_list2:ga})}$("#account-name").text(H.t_hairSalonMaster_contactUserName),$("#search_button").on("click",function(){if(""!=z.state.t_user_tel&&null!=z.state.t_user_tel){var a=getUserInfo({t_user_tel:z.state.t_user_tel});a.t_user_id>0?(B.setState({t_user_gender:a.t_user_gender}),A.setState({t_user_id:a.t_user_id,t_user_name:a.t_user_name}),C.setState({t_user_age:a.t_user_age})):alert("Unregisted PhoneNumber")}}),$(".reserve").on("click",function(){for(var a=$(".reserve").index(this),c=!1,d=0;d<ga.length;d++)"R1"==ga[d].t_menu_menuId?"R1"==!F.state.service_list[a].t_menu_menuId&&(ga=[]):"R2"==ga[d].t_menu_menuId?ga=[]:ga[d].t_menu_menuId==F.state.service_list[a].t_menu_menuId&&(c=!0);if(0==c){"R1"==F.state.service_list[a].t_menu_menuId?ga.length>0&&"R1"!=ga[0].t_menu_menuId&&(ga=[]):"R2"==F.state.service_list[a].t_menu_menuId&&(ga=[]),ga.push({t_menu_menuId:F.state.service_list[a].t_menu_menuId,t_menu_name:F.state.service_list[a].t_menu_name,t_menu_start:g,t_menu_time:F.state.service_list[a].t_menu_time,t_menu_stylist:ca[D.state.t_stylist_id],t_menu_seat:"",t_menu_price:F.state.service_list[a].t_menu_price}),ha+=Number(F.state.service_list[a].t_menu_price),ia+=Number(F.state.service_list[a].t_menu_time);var e=b(x.state.t_reservation_start,ia);f=x.state.t_reservation_start,g=e,y.setState({t_reservation_end:e})}G.setState({service_list2:ga})}),$(".delete").on("click",function(){var a=$(".delete").index(this);console.log("d_id:"+a);for(var b=0;b<ga.length;b++)ga[b].t_menu_menuId==G.state.service_list2[a].t_menu_menuId&&(console.log(ga[b].t_menu_name+","+G.state.service_list2[a].t_menu_price),ha-=Number(G.state.service_list2[a].t_menu_price),ia-=Number(G.state.service_list2[a].t_menu_time),ga.splice(b,1));G.setState({service_list2:ga})}),$("#regist").on("click",function(){var a=moment($("#date").datepicker("getDate")),d=Number(a.month())+1,e=a.year()+"-"+d+"-"+a.date()+" "+x.state.t_reservation_start,f=function(){for(var a="",b=0;b<ga.length;b++)a+=ga[b].t_menu_menuId+",";return a.length>1&&(a=a.substring(0,a.length-1)),a}();if(f.length<=0)return console.log("予約メニューが選択されていません."),void alert("予約メニューが選択されていません.");var g=ga[0].t_menu_menuId+"";if(g.indexOf("R")<0&&(""==A.state.t_user_name||""==z.state.t_user_tel))return console.log("ユーザ情報の入力が足りません."),void alert("ユーザ情報の入力が足りません.");for(var h=0,i=0;i<ga.length;i++){for(var j=0;j<W.menu.length;j++)ga[i].t_menu_menuId==W.menu[j].t_menu_menuId&&(h+=W.menu[j].t_menu_time);"R1"==ga[i].t_menu_menuId&&(h+=60)}console.log("予約メニューにかかる時間："+h+"分.");var k=getReservationList({t_reservation_salonId:H.t_hairSalonMaster_salonId,t_reservation_date:e}),l=[];l=k.reservation_list;for(var i=0;i<l.length;i++)l[i].t_reservation_id==J&&(console.log("予約編集中："+l[i].t_reservation_id),l.splice(i,1));if(void 0==l)console.log("予約しようとしている日に他の予約はありません.");else for(var i=0;i<l.length;i++)if(e.substring(0,10)==l[i].t_reservation_date.substring(0,10)){for(var m="",j=0;j<ba.stylist.length;j++)ba.stylist[j].t_stylist_Id==D.state.t_stylist_id&&(m=ba.stylist[j].t_stylist_name);if(m==l[i].t_stylist_name){var n=l[i].t_reservation_date.substring(11,16),o=b(n,l[i].t_reservation_time),p=x.state.t_reservation_start,q=b(p,h),r=c(n,o,p,q);if(r)return console.log("予約時間が競合しています. : 競合予約時刻（"+n+"〜"+o+")"),void alert("予約時間が競合しています. : 競合予約時刻（"+n+"〜"+o+")")}}if(g.indexOf("R")<0)var s=function(){var a=-1;return a=A.state.t_user_id,console.log("uid:"+a),""==a&&(ui=setRegistUser({t_user_name:A.state.t_user_name,t_user_gender:B.state.t_user_gender,t_user_tel:z.state.t_user_tel,t_user_age:C.state.t_user_age}),a=ui.t_user_id),a}();else var s=0;var t=document.forms.check_form.appoint.checked;console.log("appoint:"+t);var u;u=1==t?1:0;var v;v=0>J?{t_reservation_userId:s,t_reservation_salonId:H.t_hairSalonMaster_salonId,t_reservation_stylistId:D.state.t_stylist_id,t_reservation_date:e,t_reservation_menuId:f,t_reservation_seatId:1,t_reservation_memo:$("#memo").text(),t_reservation_appoint:u}:{t_reservation_id:J,t_reservation_userId:s,t_reservation_salonId:H.t_hairSalonMaster_salonId,t_reservation_stylistId:D.state.t_stylist_id,t_reservation_date:e,t_reservation_menuId:f,t_reservation_seatId:1,t_reservation_memo:$("#memo").text(),t_reservation_appoint:u},sanitaize.encode(v);var r=setReservationInfo(v);"true"==r.result?(alert("Regist Success"),location.href="calender.html"):alert("Regist Failed")}),$(function(){$("button",".jquery-ui-button").button(),$("#claim-opener").click(function(){$("#claim-dialog").dialog("open")});var a=($("#claim-dialog-form-name"),$("#claim-dialog-form-comment"));$("#claim-dialog").dialog({autoOpen:!1,width:350,show:"explode",hide:"explode",modal:!0,buttons:{"登録":function(){a.val()&&(J>0?d(a.val()):alert("予約情報が取得できません."),$(this).dialog("close")),$(this).dialog("close")},"キャンセル":function(){$(this).dialog("close")}}})}),$("#come").on("click",function(){e(1)}),$("#cancel").on("click",function(){$("#cancel_dialog").dialog("open")}),$("#cancel_dialog").dialog({autoOpen:!1,title:"予約取消",closeOnEscape:!1,modal:!0,buttons:{"連絡あり":function(){e(2),$(this).dialog("close")},"連絡なし":function(){e(3),$(this).dialog("close")}}})});